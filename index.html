<!DOCTYPE html>
    <title>Schedule Maker Test Demo</title>
    <head>
        <div id = "header-bar">
        </div>
    </head>
    <body>
        <!-- Using jQuery and jQuery CSV -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script src="fileManagement.js"></script>
        <script src="courseSection.js"></script>
        <script src="searchEngine.js"></script>
        <script>
            let days = ["M", "T", "W", "R", "F"];

            let schedule = {
                courses: [],
                overlapsWithCourse: function(course) {
                    for (let i = 0; i < this.courses.length; i++) {
                        if (this.courseTimesOverlap(this.courses[i], course)) {
                            return this.courseDaysOverlap(this.courses[i], course);
                        }
                    }

                    return false;
                },
                courseTimesOverlap: function(course1, course2) {
                    if (course1.startTime <= course2.startTime && course2.startTime <= course1.endTime) { return true; }
                    if (course1.startTime <= course2.endTime && course2.endTime <= course1.endTime) { return true; }
                    if (course2.startTime < course1.startTime && course1.endTime < course2.endTime) { return true; }
                    return false;
                },
                courseDaysOverlap: function(course1, course2) {
                    for (let j = 0; j < course1.days.length; j++) {
                        for (let k = 0; k < course2.days.length; k++) {
                            if (course1.days[j] == course2.days[k]) {
                                return true;
                            }
                        }
                    }
                    return false;
                }
            };

            let listingNo = 1;

            let createInterface = () => {
                for(let i = 0; i < 5; i++) {
                    $("<p/>", {
                        "html": days[i],
                        "css": {
                            "position": "absolute",
                            "right": 60 - (i * 10) + "%",
                            "top": "5%",
                            "fontSize": "15px"
                        }
                    }).appendTo("body");
                }
            }

            createInterface();
            
            for(let i = 0; i < 14; i++) {
                let timeString = (i + 8) + ":00"
                let newElement = document.createElement("p");
                newElement.innerHTML = timeString;
                newElement.style.position = "absolute";
                newElement.style.right = 70 + "%";
                newElement.style.top = 10 + (6 * i) + "%";
                newElement.style.fontSize = "11px";
                newElement.style.height = "6%";
                document.body.appendChild(newElement);
            }

            for(let i = 0; i < 5; i++) {
                let newElement = document.createElement("div");
                newElement.style.position = "absolute";
                newElement.style.width = "10%";
                newElement.style.height = "85%";
                newElement.style.right = 55 - (i * 10) + "%";
                newElement.style.top = 10 + "%";
                if (i != 4) {
                    newElement.style.borderRight = "1px solid #44449e";
                }

                document.body.appendChild(newElement);
            }

            for(let i = 0; i < 14; i++) {
                let newElement = document.createElement("div");
                newElement.style.position = "absolute";
                newElement.style.width = "60%";
                newElement.style.height = "6%";
                newElement.style.right = 9 + "%";
                newElement.style.top = 6 + (6 * i) + "%";
                newElement.style.borderBottom = "1px solid #44449e";


                document.body.appendChild(newElement);
            }

            /**

                let exitButton = document.createElement("div");
                exitButton.className = "course-info";
                exitButton.style.height = "100%";
                exitButton.style.width = "15px";
                exitButton.style.top = "0px";
                exitButton.style.right = "0px";
                exitButton.style.backgroundColor = "#994444";
                exitButton.onclick = () => {
                    exitButton.parentElement.remove();
                }
                courseInfoDiv1.appendChild(exitButton);

                document.body.appendChild(courseInfoDiv1);
            }**/

            let createCourseInfoDIV = (course) => {
                for(let i = 0; i < course.days.length; i++) {
                    let dayOffset = 1 + "MTWRF".indexOf(course.days[i]);
                    let container = $("<div/>", {
                        "css": {
                            "position": "absolute",
                            "height": (course.lengthMinutes / 10) + "%",
                            "right": 65 - (dayOffset * 10) + "%",
                            "top": 11 + ((course.startTime - 8) * 6) + "%",
                        },
                    }).attr('class', 'course-info').click(function() {
                        alert(
                                course.course + "-" + course.section + "\n"
                                    + course.days + " " + course.timeString(course.startTime) + " - " 
                                    + course.timeString(course.endTime) + "\n"
                                    + course.location + "\n" + course.llc
                            );
                    }).appendTo("body");
                    $("<p/>", {
                        "css": {
                            "margin-top": "5px",
                            "margin-bottom": "0px"
                        },
                        "html": course.course
                    }).appendTo(container);
                    $("<p/>", {
                        "css": {
                            "margin-top": "0px"
                        },
                        "html": course.timeString(course.startTime)
                    }).appendTo(container);
                }
            }

            let addCourseToSchedule = (course) => {
                if(!schedule.overlapsWithCourse(course)) {
                    schedule.courses.push(course);
                    createCourseInfoDIV(course);
                } else {
                    alert("Schedule overlaps!");
                }
                
            }

            let addCourseToListing = (crn) => {
                if (crnIsValid(crn)) {
                    let course = courseSection(crn);
                    let listing = document.createElement("p");
                    listing.innerHTML = course.toString();
                    listing.id = "listing-" + listingNo;
                    listing.style.position = "absolute";
                    listing.style.left = "15px";
                    listing.style.top = 15 + ((listingNo - 1) * 20) + "px";
                    listing.onclick = () => {
                        addCourseToSchedule(course);
                    }

                    let courseContainer = document.getElementById("course-listing");
                    courseContainer.scrollTop = courseContainer.scrollHeight;
                    courseContainer.appendChild(listing);
                    listingNo++;
                }
            }

            let addCourse = () => {
                let input = document.getElementById("crn-search");
                if (Number.isInteger(parseInt(input.value))) {
                    console.log("o");
                    let crn = parseInt(input.value);
                    if (crnIsValid(crn)) {
                        addCourseToListing(crn);
                    }
                } else {
                    let results = searchCourses(input.value);
                    console.log(results);
                    if (results.length == 1) {
                        let CRN = results[0].crn;
                        addCourseToListing(CRN);
                    } else if (results.length >= 1) {

                    }
                }
            }

        </script>
        <input type="file" id="csvFileInput" onchange="handleFiles(this.files)"
        accept=".csv">
        <style>
            #csvFileInput {
                position: absolute;
                top: 5px;
                left: 40%;
            }

            #course-container {
                position: absolute;
                left: 0px;
                top: 0px;
                width: 25%;
                height: 100%;
                border-right: 1px solid #44449e;
            }

            #course-listing {
                position: absolute;
                left: 15px;
                top: 40%;
                width: 90%;
                height: 25%;
                border: 1px solid #44449e;
                border-radius: 2px;
                overflow: auto;
            }

            .course-info {
                position: absolute;
                width: 9%;
                font-size: 13px;
                background-color: #aeaedb;
                margin: 0.5%;
            }

            #cnu-logo {
                position: absolute;
                right: 0px;
            }
        </style>
        <div id = "course-container">
            Enter the CRN or registration name of your class here: <input id="crn-search"></input>
            <button id="search_courses" onclick="addCourse()">Search</button>
            <div id = "course-listing">
                Your courses:
            </div>
        </div>
    </body>
</html>